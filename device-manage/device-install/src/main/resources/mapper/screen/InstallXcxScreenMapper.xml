<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smart.device.install.mapper.screen.InstallXcxScreenMapper">

    <select id="queryInstallDevicesList" resultType="com.smart.device.common.install.entity.vo.DeviceCompanyVo">
        select * from (select t.imei,t.device_name,t.device_code,t.device_id,t.company_id,t.company_name,t.building_name,t.building_floor,t.parent_type,t.device_type_name,
        t.location,t.longitude,t.latitude,t.province,t.city,t.county,t.town,t.housing,t.device_state_name from t_manager_smoke t
        <where>
            <if test="vo.deviceType != null ">
                and t.parent_type = #{vo.deviceType}
            </if>
            <if test="vo.companyId != null ">
                and t.company_id = #{vo.companyId}
            </if>
            <if test="vo.opUserId != null ">
                and t.op_user_id = #{vo.opUserId}
            </if>
            <if test="vo.imei != null ">
                and t.imei like concat('%',#{vo.imei},'%')
            </if>
        </where>
         ORDER BY t.create_time desc limit #{start},#{limit} ) t1
        union all
        select * from (select t.imei,t.device_name,t.device_code,t.device_id,t.company_id,t.company_name,t.building_name,t.building_floor,t.parent_type,t.device_type_name,
        t.location,t.longitude,t.latitude,t.province,t.city,t.county,t.town,t.housing,t.device_state_name  from t_manager_waterpress t
        <where>
            <if test="vo.deviceType != null ">
                and t.parent_type = #{vo.deviceType}
            </if>
            <if test="vo.companyId != null ">
                and t.company_id = #{vo.companyId}
            </if>
            <if test="vo.opUserId != null ">
                and t.op_user_id = #{vo.opUserId}
            </if>
            <if test="vo.imei != null ">
                and t.imei like concat('%',#{vo.imei},'%')
            </if>
        </where>
         ORDER BY t.create_time desc limit #{start},#{limit}) t2
        union all
        select * from (select t.imei,t.device_name,t.device_code,t.device_id,t.company_id,t.company_name,t.building_name,t.building_floor,t.parent_type,t.device_type_name,
        t.location,t.longitude,t.latitude,t.province,t.city,t.county,t.town,t.housing,t.device_state_name  from t_manager_electric t
        <where>
            <if test="vo.deviceType != null ">
                and t.parent_type = #{vo.deviceType}
            </if>
            <if test="vo.companyId != null ">
                and t.company_id = #{vo.companyId}
            </if>
            <if test="vo.opUserId != null ">
                and t.op_user_id = #{vo.opUserId}
            </if>
            <if test="vo.imei != null ">
                and t.imei like concat('%',#{vo.imei},'%')
            </if>
        </where>
         ORDER BY t.create_time desc limit #{start},#{limit}) t3
    </select>

    <select id="queryInstallDevicesListCount" resultType="java.lang.Long">
        select count(*) from ( select * from (select t.id from t_manager_smoke t
        <where>
            <if test="vo.deviceType != null ">
                and t.device_type = #{vo.deviceType}
            </if>
            <if test="vo.companyId != null ">
                and t.company_id = #{vo.companyId}
            </if>
            <if test="vo.opUserId != null ">
                and t.op_user_id = #{vo.opUserId}
            </if>
            <if test="vo.imei != null ">
                and t.imei like concat('%',#{vo.imei},'%')
            </if>
        </where>
        ORDER BY t.create_time desc ) t1
        union all
        select * from (select t.id  from t_manager_waterpress t
        <where>
            <if test="vo.deviceType != null ">
                and t.device_type = #{vo.deviceType}
            </if>
            <if test="vo.companyId != null ">
                and t.company_id = #{vo.companyId}
            </if>
            <if test="vo.opUserId != null ">
                and t.op_user_id = #{vo.opUserId}
            </if>
            <if test="vo.imei != null ">
                and t.imei like concat('%',#{vo.imei},'%')
            </if>
        </where>
        ORDER BY t.create_time desc ) t2
        union all
        select * from (select t.id from t_manager_electric t
        <where>
            <if test="vo.deviceType != null ">
                and t.device_type = #{vo.deviceType}
            </if>
            <if test="vo.companyId != null  ">
                and t.company_id = #{vo.companyId}
            </if>
            <if test="vo.opUserId != null ">
                and t.op_user_id = #{vo.opUserId}
            </if>
            <if test="vo.imei != null ">
                and t.imei like concat('%',#{vo.imei},'%')
            </if>
        </where>
        ORDER BY t.create_time desc ) t3 ) t
    </select>


</mapper>
