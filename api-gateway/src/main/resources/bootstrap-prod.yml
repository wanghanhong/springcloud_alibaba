server:
  port: 9200
info:
  nacos:
    address: 192.168.0.169:8848
spring:
  application:
    name: api-gateway
  devtools:
    restart:
      enabled: true
  profiles:
    active: prod
  cloud:
    nacos:
      discovery:
        server-addr: ${info.nacos.address}
      config:
        server-addr: ${info.nacos.address}
        file-extension: yaml
        prefix: ${spring.application.name}
    gateway:
      discovery:
        locator:
          #表明gateway开启服务注册和发现的功能，并且spring cloud gateway自动根据服务发现为每一个服务创建了一个router，这个router将以服务名开头的请求路径转发到对应的服务。
          enabled: true

      routes:
      # 认证中心
      - id: api-auth
        uri: lb://api-auth
        predicates:
        - Path=/auth/**
        filters:
        # 验证码处理
        - CacheRequest
        - ImgCodeFilter
        - StripPrefix=1
      # 测试服务
      - id: test-demo
        uri: lb://test-demo
        predicates:
        - Path=/test/**
      # 代码生成
      - id: ruoyi-gen
        uri: lb://ruoyi-gen
        predicates:
        - Path=/gen/**
        filters:
        - StripPrefix=1
      # dfs
      - id: ruoyi-dfs
        uri: lb://ruoyi-dfs
        predicates:
        - Path=/dfs/**
        filters:
        - StripPrefix=1
      # 设备安装服务
      - id: device-access
        uri: lb://device-access
        predicates:
        - Path=/device_access/**
        filters:
        - StripPrefix=1
      # 设备安装服务
      - id: device-install
        uri: lb://device-install
        predicates:
        - Path=/device_install/**
        filters:
        - StripPrefix=1
        # 设备消息服务
      - id: device-message
        uri: lb://device-message
        predicates:
        - Path=/device_message/**
        filters:
        - StripPrefix=1
        # 消息服务
      - id: message-manage
        uri: lb://message-manage
        predicates:
        - Path=/message_manage/**
        filters:
        - StripPrefix=1
        # 用户服务
      - id: smoke-fire-platform
        uri: lb://smoke-fire-platform
        predicates:
        - Path=/smoke_fire_platform/**
        filters:
        - StripPrefix=1
        # 大屏服务
      - id: smart-fire-platform
        uri: lb://smart-fire-platform
        predicates:
        - Path=/smart_fire_platform/**
        filters:
        - StripPrefix=1
        # 宣传服务
      - id: publicize-manage
        uri: lb://publicize-manage
        predicates:
        - Path=/publicize_manage/**
        filters:
        - StripPrefix=1
      # act
      - id: ruoyi-activiti
        uri: lb://ruoyi-activiti
        predicates:
        - Path=/act/**
        filters:
        - StripPrefix=1
      #system 模块
      - id: api-authority
        uri: lb://api-authority
        predicates:
        - Path=/system/**
        filters:
        - StripPrefix=1
        # 限流配置
        - name: RequestRateLimiter
          args:
            key-resolver: '#{@remoteAddrKeyResolver}'
            redis-rate-limiter.replenishRate: 10
            redis-rate-limiter.burstCapacity: 20
          # 降级配置
        - name: Hystrix
          args:
            name: fallbackcmd
            fallbackUri: 'forward:/fallback'
  redis:
    database: 0
    host: 192.168.0.81
    port: 6379
    password: wlw@2020
    timeout: 6000
    jedis:
      pool:
        # 连接池最大连接数（使用负值表示没有限制）
        max-active: 200
        # 连接池最大阻塞等待时间（使用负值表示没有限制）
        max-wait: -1
        max-idle: 10
        min-idle: 0
hystrix:
  command:
    default:  #default全局有效，service id指定应用有效
      execution:
        timeout:
          enabled: true
        isolation:
          thread:
            timeoutInMilliseconds: 5000 #断路器超时时间，默认1000ms
logging:
  level:
    com.alibaba.nacos.client.naming: error
    org.springframework.cloud.gateway: debug

management:
  endpoints:
    web:
      exposure:
        include: ['httptrace', 'metrics']